# Audio Label Pro - 开发计划

> 版本: v1.3.0
> 创建日期: 2026-02-13
> 最后更新: 2026-02-13

---

## 📋 目录

- [1. 项目概述](#1-项目概述)
- [2. 开发阶段划分](#2-开发阶段划分)
- [3. 阶段一：基础框架与用户认证](#阶段一基础框架与用户认证)
- [4. 阶段二：音频管理与播放器](#阶段二音频管理与播放器)
- [5. 阶段三：标注功能核心](#阶段三标注功能核心)
- [6. 阶段四：AI 辅助功能](#阶段四ai-辅助功能)
- [7. 阶段五：实时协作](#阶段五实时协作)
- [8. 阶段六：质量控制与任务管理](#阶段六质量控制与任务管理)
- [9. 阶段七：热力图与高级功能](#阶段七热力图与高级功能)
- [10. 阶段八：长音频优化](#阶段八长音频优化)
- [11. 阶段九：性能优化与测试](#阶段九性能优化与测试)
- [12. 阶段十：部署与上线](#阶段十部署与上线)

---

## 1. 项目概述

### 1.1 项目目标

构建一个专业的 Web 语音数据标注平台，支持：
- 团队协作完成大规模语音数据标注
- AI 辅助提高标注效率
- 实时同步保证协作流畅
- 支持长音频（10+ 小时）场景

### 1.2 当前状态

✅ **已完成**（2026-02-13）：
- 项目基础架构搭建
- 前端 Vue 3 + TypeScript + Vite 框架
- 后端 NestJS + Fastify + TypeORM 框架
- AI 服务 FastAPI + PyTorch 框架
- Docker 环境配置（PostgreSQL、Redis、MinIO）
- 基础页面框架
- 所有依赖安装和构建验证
- 开发环境服务启动（前端、后端、AI 服务）
- 前端 TypeScript 类型系统配置

🚧 **进行中**：
- 数据库设计与迁移

⏳ **待开发**：
- 用户认证模块
- 权限管理模块
- 项目管理模块
- 核心业务功能实现
- AI 模型集成
- 实时协作功能
- 性能优化

### 1.3 开发原则

- **MVP 优先**：先实现核心功能，再扩展高级特性
- **迭代开发**：分阶段交付，持续反馈和改进
- **质量优先**：每个阶段完成后进行测试和验收
- **文档同步**：代码与文档同步更新

---

## 2. 开发阶段划分

| 阶段 | 名称 | 优先级 | 预估工作量 | 状态 |
|------|------|--------|------------|------|
| 阶段一 | 基础框架与用户认证 | ⭐⭐⭐ | 1 周 | 🚧 进行中（数据库设计和认证API已完成） |
| 阶段二 | 音频管理与播放器 | ⭐⭐⭐ | 1.5 周 | ⏳ 待开始 |
| 阶段三 | 标注功能核心 | ⭐⭐⭐ | 2 周 | ⏳ 待开始 |
| 阶段四 | AI 辅助功能 | ⭐⭐⭐ | 2 周 | ⏳ 待开始 |
| 阶段五 | 实时协作 | ⭐⭐ | 1.5 周 | ⏳ 待开始 |
| 阶段六 | 质量控制与任务管理 | ⭐⭐ | 1.5 周 | ⏳ 待开始 |
| 阶段七 | 热力图与高级功能 | ⭐⭐ | 1 周 | ⏳ 待开始 |
| 阶段八 | 长音频优化 | ⭐⭐ | 2 周 | ⏳ 待开始 |
| 阶段九 | 性能优化与测试 | ⭐ | 1.5 周 | ⏳ 待开始 |
| 阶段十 | 部署与上线 | ⭐ | 1 周 | ⏳ 待开始 |

**总预估工作量**：约 15 周

---

## 阶段一：基础框架与用户认证

### 📊 当前进度（2026-02-13）

**已完成**：
- ✅ 项目基础架构搭建
- ✅ 前端 Vue 3 + TypeScript + Vite 框架配置
- ✅ 后端 NestJS + Fastify + TypeORM 框架配置
- ✅ AI 服务 FastAPI + PyTorch 框架配置
- ✅ Docker 环境配置（PostgreSQL:5432, Redis:6380, MinIO:9000-9001）
- ✅ 前端 TypeScript 类型系统配置（Vue 类型声明、PostCSS 配置）
- ✅ 所有依赖安装和构建验证
- ✅ 开发环境服务启动
  - 前端: http://localhost:5173/
  - 后端: http://localhost:3000/
  - AI 服务: http://localhost:8000/
- ✅ 数据库设计与迁移（users, teams, team_members, projects, sessions）
- ✅ TypeORM 实体定义（5 个核心实体）
- ✅ JWT 服务（令牌生成、验证、刷新）
- ✅ 密码加密服务（bcrypt）
- ✅ Auth DTO（注册、登录、刷新）
- ✅ Auth Controller（/api/auth/register, /api/auth/login, /api/auth/refresh, /api/auth/logout）
- ✅ Auth Guard（JWT 认证守卫）
- ✅ Roles Guard（角色权限守卫）
- ✅ 公共路由装饰器（@Public）
- ✅ 认证 API 测试通过（成功注册用户）
- ✅ 前端 HTTP 服务（axios 拦截器、自动刷新）
- ✅ 前端 Auth 服务（登录、注册、登出）
- ✅ 前端 Token 存储（localStorage）
- ✅ 前端自动登录（Pinia store）
- ✅ 前端登录页面（LoginPage.vue）
- ✅ 前端注册页面（RegisterPage.vue）
- ✅ 前端路由权限守卫
- ✅ 项目管理模块（后端 API + 前端服务）
- ✅ 团队管理模块（后端 API + 前端服务）
- ✅ 后端构建成功

**进行中**：
- 无

**下一步任务**：
1. 测试项目管理 API
2. 测试团队管理 API
3. 开始阶段二：音频管理与播放器

### 目标
- 完成用户认证系统
- 实现基础权限管理
- 建立项目、团队管理

### 任务清单

#### 1.1 数据库设计与迁移

**后端任务**：
- [x] 创建用户表（users）
- [x] 创建团队表（teams）
- [x] 创建团队成员表（team_members）
- [x] 创建项目表（projects）
- [x] 创建会话表（sessions）
- [x] 编写数据库迁移脚本
- [x] 配置 TypeORM 连接

**验收标准**：
- ✅ 数据库表结构符合设计文档
- ✅ 迁移脚本可重复执行
- ✅ 索引配置合理

#### 1.2 用户认证模块

**后端任务**：
- [x] 实现用户注册 API（POST /api/auth/register）
- [x] 实现用户登录 API（POST /api/auth/login）
- [x] 实现 JWT 令牌生成和验证
- [x] 实现密码加密（bcrypt）
- [x] 实现刷新令牌机制
- [x] 实现登出 API（POST /api/auth/logout）
- [x] 实现密码重置功能（POST /api/auth/request-password-reset, POST /api/auth/reset-password）
- [x] 添加认证守卫（Auth Guard）

**前端任务**：
- [x] 创建登录页面（LoginPage.vue）
- [x] 创建注册页面（RegisterPage.vue）
- [x] 实现登录表单验证
- [x] 实现注册表单验证
- [x] 实现令牌存储（localStorage）
- [x] 实现自动登录
- [x] 实现登出功能
- [x] 实现密码重置页面（RequestPasswordResetPage.vue, ResetPasswordPage.vue）

**验收标准**：
- ✅ 用户可以注册、登录、登出
- ✅ 令牌自动刷新机制正常
- [ ] 未登录用户无法访问受保护页面
- ✅ 密码加密存储
- ✅ 用户可以请求密码重置
- ✅ 用户可以通过重置链接重置密码

#### 1.3 权限管理模块

**后端任务**：
- [x] 实现角色守卫（Role Guard）
- [x] 实现权限装饰器（@Roles）
- [ ] 实现资源访问控制
- [ ] 实现团队角色验证

**前端任务**：
- [x] 实现权限检查工具函数
- [ ] 实现角色-based UI 显示
- [x] 实现路由权限守卫

**验收标准**：
- ✅ 不同角色访问权限正确
- [ ] 前端根据角色显示不同功能
- ✅ API 权限验证正确

#### 1.4 项目管理模块

**后端任务**：
- [x] 实现创建项目 API（POST /api/projects）
- [x] 实现获取项目列表 API（GET /api/projects）
- [x] 实现获取项目详情 API（GET /api/projects/:id）
- [x] 实现更新项目 API（PATCH /api/projects/:id）
- [x] 实现删除项目 API（DELETE /api/projects/:id）
- [ ] 实现项目成员管理 API

**前端任务**：
- [ ] 创建项目列表页面
- [ ] 创建项目创建页面
- [ ] 创建项目详情页面
- [ ] 实现项目卡片组件
- [ ] 实现项目成员管理界面

**验收标准**：
- ✅ 用户可以创建、查看、编辑、删除项目
- ✅ 项目成员管理功能正常
- ✅ 项目数据正确存储和显示

#### 1.5 团队管理模块

**后端任务**：
- [x] 实现创建团队 API（POST /api/teams）
- [x] 实现邀请成员 API（POST /api/teams/:id/invite）
- [ ] 实现接受邀请 API（POST /api/teams/:id/accept）
- [x] 实现移除成员 API（DELETE /api/teams/:id/members/:userId）
- [x] 实现团队角色管理 API

**前端任务**：
- [ ] 创建团队管理页面
- [ ] 创建邀请成员对话框
- [ ] 实现团队成员列表
- [ ] 实现团队角色设置

**验收标准**：
- ✅ 用户可以创建团队
- ✅ 成员邀请和加入功能正常
- ✅ 团队角色管理正确

### 技术要点

- JWT 令牌管理
- 密码加密（bcrypt）
- RBAC 权限控制
- TypeORM 实体关系
- 前端路由守卫

### 预估完成时间
- 5 个工作日

---

## 阶段二：音频管理与播放器

### 目标
- 实现音频文件管理功能
- 实现音频播放器
- 实现波形可视化

### 任务清单

#### 2.1 音频文件管理

**后端任务**：
- [ ] 创建音频文件表（audio_files）
- [ ] 创建音频文件夹表（audio_folders）
- [ ] 实现音频上传 API（POST /api/audio/upload）
- [ ] 实现批量上传 API（POST /api/audio/batch-upload）
- [ ] 实现获取音频列表 API（GET /api/audio）
- [ ] 实现获取音频详情 API（GET /api/audio/:id）
- [ ] 实现音频文件删除 API（DELETE /api/audio/:id）
- [ ] 实现文件夹管理 API（创建、移动、删除）
- [ ] 集成 MinIO 对象存储
- [ ] 实现音频元数据提取（时长、采样率等）

**前端任务**：
- [ ] 创建音频列表页面
- [ ] 创建音频上传组件
- [ ] 实现拖拽上传功能
- [ ] 实现上传进度显示
- [ ] 创建文件夹树组件
- [ ] 实现文件预览功能
- [ ] 实现文件管理（重命名、移动、删除）

**验收标准**：
- ✅ 支持批量上传音频文件
- ✅ 上传进度实时显示
- ✅ 文件夹管理功能正常
- ✅ 音频元数据正确提取

#### 2.2 音频播放器

**后端任务**：
- [ ] 实现音频流式传输 API（GET /api/audio/:id/stream）
- [ ] 实现音频下载 API（GET /api/audio/:id/download）
- [ ] 配置文件流支持范围请求

**前端任务**：
- [ ] 创建音频播放器组件
- [ ] 实现播放/暂停控制
- [ ] 实现停止功能
- [ ] 实现进度条拖拽
- [ ] 实现时间显示
- [ ] 实现音量控制
- [ ] 实现静音切换
- [ ] 实现快捷键支持（空格、方向键等）
- [ ] 实现播放速度控制（0.5x ~ 2x）
- [ ] 实现循环播放（A-B 点）

**验收标准**：
- ✅ 播放器控制功能完整
- ✅ 快捷键响应灵敏
- ✅ 播放状态正确显示

#### 2.3 波形可视化

**后端任务**：
- [ ] 实现音频解码服务
- [ ] 实现波形数据生成 API
- [ ] 实现波形数据缓存（Redis）
- [ ] 创建波形缓存表（waveform_cache）

**前端任务**：
- [ ] 集成 WaveSurfer.js
- [ ] 创建波形可视化组件
- [ ] 实现波形渲染
- [ ] 实现波形缩放
- [ ] 实现波形拖拽
- [ ] 实现点击跳转
- [ ] 实现波形双击重置
- [ ] 实现多级波形渲染（Overview、Detail、Zoom）

**验收标准**：
- ✅ 波形正确显示
- ✅ 缩放和平移流畅
- ✅ 波形数据缓存有效

#### 2.4 音频元数据管理

**后端任务**：
- [ ] 实现元数据更新 API（PATCH /api/audio/:id/metadata）
- [ ] 实现自定义字段存储

**前端任务**：
- [ ] 创建元数据编辑面板
- [ ] 实现自定义字段添加
- [ ] 实现元数据保存

**验收标准**：
- ✅ 元数据正确保存和显示
- ✅ 自定义字段功能正常

### 技术要点

- MinIO 对象存储
- 文件流式传输
- WaveSurfer.js 集成
- 音频元数据提取
- 波形数据压缩缓存

### 预估完成时间
- 7.5 个工作日

---

## 阶段三：标注功能核心

### 目标
- 实现标注 CRUD 操作
- 实现时间区间选择
- 实现文本转写编辑
- 实现多层标注

### 任务清单

#### 3.1 标注 CRUD

**后端任务**：
- [ ] 创建标注表（annotations）
- [ ] 创建标注层表（annotation_layers）
- [ ] 创建说话人表（speakers）
- [ ] 创建标签表（tags）
- [ ] 创建标注标签关联表（annotation_tags）
- [ ] 实现创建标注 API（POST /api/annotations）
- [ ] 实现获取标注列表 API（GET /api/annotations）
- [ ] 实现获取标注详情 API（GET /api/annotations/:id）
- [ ] 实现更新标注 API（PATCH /api/annotations/:id）
- [ ] 实现删除标注 API（DELETE /api/annotations/:id）
- [ ] 实现批量操作 API

**前端任务**：
- [ ] 创建标注列表组件
- [ ] 创建标注编辑面板
- [ ] 实现标注创建表单
- [ ] 实现标注编辑功能
- [ ] 实现标注删除确认
- [ ] 实现批量选择和操作

**验收标准**：
- ✅ 标注 CRUD 功能完整
- ✅ 时间区间正确存储和显示
- ✅ 批量操作功能正常

#### 3.2 时间区间选择

**前端任务**：
- [ ] 实现波形拖拽选择
- [ ] 实现选区高亮显示
- [ ] 实现选区边缘拖拽调整
- [ ] 实现精确时间输入
- [ ] 实现选区合并/拆分
- [ ] 实现选区删除

**验收标准**：
- ✅ 拖拽选择流畅
- ✅ 选区显示清晰
- ✅ 时间调整精确

#### 3.3 文本转写编辑

**前端任务**：
- [ ] 集成富文本编辑器（Tiptap）
- [ ] 实现文本输入
- [ ] 实现时间戳插入
- [ ] 实现说话人标记
- [ ] 实现非语音标记
- [ ] 实现文本格式化
- [ ] 实现字数统计

**验收标准**：
- ✅ 文本编辑功能完整
- ✅ 时间戳正确插入
- ✅ 说话人标记清晰

#### 3.4 多层标注

**后端任务**：
- [ ] 实现标注层 CRUD API
- [ ] 实现层可见性控制 API
- [ ] 实现层锁定 API

**前端任务**：
- [ ] 创建层面板组件
- [ ] 实现层创建功能
- [ ] 实现层切换功能
- [ ] 实现层可见性开关
- [ ] 实现层拖拽排序
- [ ] 实现层颜色设置
- [ ] 实现多层标注显示

**验收标准**：
- ✅ 多层标注功能正常
- ✅ 层管理界面清晰
- ✅ 层可见性控制正确

#### 3.5 标签体系

**后端任务**：
- [ ] 实现标签 CRUD API
- [ ] 实现标签分类 API
- [ ] 实现标签搜索 API

**前端任务**：
- [ ] 创建标签选择器组件
- [ ] 实现标签添加功能
- [ ] 实现标签搜索
- [ ] 实现标签分类显示
- [ ] 实现标签颜色选择
- [ ] 实现标签层级树

**验收标准**：
- ✅ 标签体系功能完整
- ✅ 标签搜索快速
- ✅ 标签层级清晰

#### 3.6 说话人管理

**后端任务**：
- [ ] 实现说话人 CRUD API
- [ ] 实现说话人统计 API

**前端任务**：
- [ ] 创建说话人管理组件
- [ ] 实现说话人创建
- [ ] 实现说话人重命名
- [ ] 实现说话人合并
- [ ] 实现说话人颜色设置

**验收标准**：
- ✅ 说话人管理功能完整
- ✅ 说话人统计准确

### 技术要点

- Tiptap 富文本编辑器
- 时间戳管理
- 多层数据结构
- 标签树形结构

### 预估完成时间
- 10 个工作日

---

## 阶段四：AI 辅助功能

### 目标
- 集成 Whisper ASR 模型
- 实现说话人分离
- 实现自动分段
- 实现智能标签推荐

### 任务清单

#### 4.1 AI 服务基础架构

**AI 服务任务**：
- [ ] 配置 Whisper 模型加载
- [ ] 配置 Pyannote.audio 模型加载
- [ ] 实现 Celery 任务队列
- [ ] 实现 Redis 消息代理
- [ ] 实现模型缓存机制
- [ ] 实现模型版本管理

**验收标准**：
- ✅ AI 模型正确加载
- ✅ Celery 任务队列正常
- ✅ 模型缓存有效

#### 4.2 自动语音识别（ASR）

**AI 服务任务**：
- [ ] 实现音频下载服务
- [ ] 实现 Whisper 转写任务
- [ ] 实现流式结果推送
- [ ] 实现置信度计算
- [ ] 实现多语言支持
- [ ] 实现模型选择逻辑

**后端任务**：
- [ ] 创建 AI 任务表（ai_jobs）
- [ ] 创建 AI 任务进度表（ai_job_progress）
- [ ] 创建 AI 结果分片表（ai_result_chunks）
- [ ] 实现 ASR 触发 API
- [ ] 实现进度查询 API
- [ ] 实现结果获取 API
- [ ] 实现 WebSocket 进度推送

**前端任务**：
- [ ] 创建 AI 转写按钮
- [ ] 创建处理进度面板
- [ ] 实现进度条显示
- [ ] 实现结果实时显示
- [ ] 实现置信度可视化
- [ ] 实现模型选择界面
- [ ] 实现低置信度高亮

**验收标准**：
- ✅ ASR 转写准确
- ✅ 进度实时更新
- ✅ 置信度正确显示
- ✅ 模型切换正常

#### 4.3 说话人分离

**AI 服务任务**：
- [ ] 实现 Pyannote.audio 任务
- [ ] 实现说话人识别
- [ ] 实现说话人统计
- [ ] 实现说话人段落合并

**后端任务**：
- [ ] 实现说话人分离 API
- [ ] 实现说话人结果存储

**前端任务**：
- [ ] 创建说话人分离按钮
- [ ] 实现说话人颜色标识
- [ ] 实现说话人管理面板
- [ ] 实现说话人合并/拆分

**验收标准**：
- ✅ 说话人识别准确
- ✅ 说话人颜色清晰
- ✅ 说话人管理功能正常

#### 4.4 自动分段

**AI 服务任务**：
- [ ] 实现静音检测算法
- [ ] 实现分段逻辑
- [ ] 实现分段元数据提取
- [ ] 实现分段评分

**后端任务**：
- [ ] 创建音频分段表（audio_segments）
- [ ] 实现自动分段 API
- [ ] 实现分段参数配置

**前端任务**：
- [ ] 创建自动分段按钮
- [ ] 创建分段参数面板
- [ ] 实现分段标记显示
- [ ] 实现分段调整功能

**验收标准**：
- ✅ 分段逻辑合理
- ✅ 分段参数可配置
- ✅ 分段调整灵活

#### 4.5 智能标签推荐

**AI 服务任务**：
- [ ] 实现标签推荐模型
- [ ] 实现情感分析
- [ ] 实现场景识别
- [ ] 实现推荐置信度计算

**后端任务**：
- [ ] 实现标签推荐 API
- [ ] 实现推荐结果存储

**前端任务**：
- [ ] 创建智能推荐按钮
- [ ] 创建推荐面板
- [ ] 实现推荐标签显示
- [ ] 实现一键添加功能

**验收标准**：
- ✅ 标签推荐准确
- ✅ 推荐置信度合理
- ✅ 一键添加功能正常

#### 4.6 噪音检测

**AI 服务任务**：
- [ ] 实现噪音识别算法
- [ ] 实现噪音分类
- [ ] 实现噪音强度评分

**前端任务**：
- [ ] 创建噪音检测按钮
- [ ] 实现噪音区域标记
- [ ] 实现噪音类型显示

**验收标准**：
- ✅ 噪音识别准确
- ✅ 噪音标记清晰

#### 4.7 AI 模型管理

**后端任务**：
- [ ] 实现模型列表 API
- [ ] 实现模型上传 API（管理员）
- [ ] 实现模型性能评估
- [ ] 实现模型版本历史

**前端任务**：
- [ ] 创建 AI 设置面板
- [ ] 创建模型选择界面
- [ ] 创建模型管理界面
- [ ] 实现模型性能显示

**验收标准**：
- ✅ 模型管理功能完整
- ✅ 模型性能清晰
- ✅ 模型切换流畅

### 技术要点

- OpenAI Whisper 集成
- Pyannote.audio 集成
- Celery 异步任务
- Redis 消息队列
- WebSocket 实时推送
- 模型缓存机制

### 预估完成时间
- 10 个工作日

---

## 阶段五：实时协作

### 目标
- 实现多人实时编辑
- 实现编辑锁定
- 实现评论系统
- 实现版本控制

### 任务清单

#### 5.1 WebSocket 连接管理

**后端任务**：
- [ ] 配置 Socket.io 服务器
- [ ] 实现 Redis Adapter（支持多实例）
- [ ] 实现房间管理（音频房间、任务房间）
- [ ] 实现连接重连机制
- [ ] 实现心跳检测

**前端任务**：
- [ ] 配置 Socket.io 客户端
- [ ] 实现连接状态管理
- [ ] 实现自动重连
- [ ] 实现错误处理

**验收标准**：
- ✅ WebSocket 连接稳定
- ✅ 自动重连正常
- ✅ 房间管理正确

#### 5.2 多人协作编辑

**后端任务**：
- [ ] 实现编辑同步 API
- [ ] 实现光标位置同步
- [ ] 实现选区同步
- [ ] 实现播放状态同步
- [ ] 实现协作者列表 API

**前端任务**：
- [ ] 创建协作者面板
- [ ] 实现协作者光标显示
- [ ] 实现协作者选区高亮
- [ ] 实现播放位置同步
- [ ] 实现在线状态显示

**验收标准**：
- ✅ 编辑实时同步
- ✅ 协作者光标清晰
- ✅ 播放状态同步

#### 5.3 编辑锁定

**后端任务**：
- [ ] 实现锁定 API
- [ ] 实现锁定超时机制
- [ ] 实现锁定释放 API

**前端任务**：
- [ ] 实现编辑时自动锁定
- [ ] 实现锁定状态显示
- [ ] 实现锁定冲突提示
- [ ] 实现强制解锁（管理员）

**验收标准**：
- ✅ 锁定机制可靠
- ✅ 锁定状态清晰
- ✅ 冲突提示及时

#### 5.4 评论系统

**后端任务**：
- [ ] 创建评论表（comments）
- [ ] 实现创建评论 API
- [ ] 实现获取评论列表 API
- [ ] 实现回复评论 API
- [ ] 实现 @ 提及功能
- [ ] 实现 WebSocket 评论推送

**前端任务**：
- [ ] 创建评论面板
- [ ] 创建评论输入组件
- [ ] 实现 @ 提及选择器
- [ ] 实现评论时间标记
- [ ] 实现评论线程显示
- [ ] 实现评论实时通知

**验收标准**：
- ✅ 评论功能完整
- ✅ @ 提及功能正常
- ✅ 评论实时推送

#### 5.5 版本控制

**后端任务**：
- [ ] 创建版本历史表（annotation_versions）
- [ ] 实现自动保存逻辑
- [ ] 实现版本列表 API
- [ ] 实现版本对比 API
- [ ] 实现版本回滚 API
- [ ] 实现版本清理任务

**前端任务**：
- [ ] 创建版本历史面板
- [ ] 实现版本列表显示
- [ ] 实现版本对比视图
- [ ] 实现版本回滚确认
- [ ] 实现保存状态显示

**验收标准**：
- ✅ 版本历史完整
- ✅ 版本对比清晰
- ✅ 版本回滚可靠

#### 5.6 消息通知

**后端任务**：
- [ ] 创建通知表（notifications）
- [ ] 实现创建通知 API
- [ ] 实现获取通知列表 API
- [ ] 实现标记已读 API
- [ ] 实现 WebSocket 通知推送
- [ ] 实现通知清理任务

**前端任务**：
- [ ] 创建通知中心组件
- [ ] 创建通知铃铛图标
- [ ] 实现未读数显示
- [ ] 实现通知列表显示
- [ ] 实现通知点击跳转
- [ ] 实现通知偏好设置

**验收标准**：
- ✅ 通知推送及时
- ✅ 通知显示清晰
- ✅ 通知跳转正确

### 技术要点

- Socket.io 实时通信
- Redis Adapter 多实例支持
- 房间管理机制
- 编辑冲突解决
- 版本差分算法

### 预估完成时间
- 7.5 个工作日

---

## 阶段六：质量控制与任务管理

### 目标
- 实现审核流程
- 实现任务管理
- 实现统计报表
- 实现数据导出

### 任务清单

#### 6.1 审核流程

**后端任务**：
- [ ] 实现提交审核 API
- [ ] 实现审核 API
- [ ] 实现审核通过 API
- [ ] 实现审核驳回 API
- [ ] 实现审核历史 API

**前端任务**：
- [ ] 创建提交审核按钮
- [ ] 创建审核界面
- [ ] 实现审核通过/驳回
- [ ] 实现驳回原因输入
- [ ] 实现审核历史显示

**验收标准**：
- ✅ 审核流程完整
- ✅ 审核状态正确
- ✅ 驳回原因清晰

#### 6.2 问题标记

**后端任务**：
- [ ] 实现问题标记 API
- [ ] 实现问题列表 API
- [ ] 实现问题解决 API

**前端任务**：
- [ ] 创建问题标记组件
- [ ] 实现问题类型选择
- [ ] 实现问题描述输入
- [ ] 创建问题列表面板

**验收标准**：
- ✅ 问题标记功能正常
- ✅ 问题列表清晰

#### 6.3 质量评分

**后端任务**：
- [ ] 实现质量评分算法
- [ ] 实现质量评分 API
- [ ] 实现低分标记逻辑

**前端任务**：
- [ ] 创建质量评分显示
- [ ] 实现评分详情面板
- [ ] 实现低分警告提示

**验收标准**：
- ✅ 质量评分准确
- ✅ 评分详情清晰

#### 6.4 任务管理

**后端任务**：
- [ ] 创建任务表（tasks）
- [ ] 实现创建任务 API
- [ ] 实现获取任务列表 API
- [ ] 实现分配任务 API
- [ ] 实现任务进度 API
- [ ] 实现任务状态更新 API

**前端任务**：
- [ ] 创建任务列表页面
- [ ] 创建任务创建页面
- [ ] 创建任务详情页面
- [ ] 实现任务分配界面
- [ ] 实现任务进度面板
- [ ] 实现任务筛选和排序

**验收标准**：
- ✅ 任务管理功能完整
- ✅ 任务分配灵活
- ✅ 任务进度清晰

#### 6.5 统计报表

**后端任务**：
- [ ] 实现个人工作量统计 API
- [ ] 实现团队工作量统计 API
- [ ] 实现项目进度统计 API
- [ ] 实现质量分析统计 API

**前端任务**：
- [ ] 创建统计报表页面
- [ ] 集成 ECharts 图表
- [ ] 实现数据可视化
- [ ] 实现报表导出功能
- [ ] 实现时间范围选择

**验收标准**：
- ✅ 统计数据准确
- ✅ 图表显示清晰
- ✅ 导出功能正常

#### 6.6 数据导出

**后端任务**：
- [ ] 实现 JSON 导出 API
- [ ] 实现 CSV 导出 API
- [ ] 实现 TXT 导出 API
- [ ] 实现 SRT 导出 API
- [ ] 实现 VTT 导出 API
- [ ] 实现 XML 导出 API
- [ ] 实现批量导出 API

**前端任务**：
- [ ] 创建导出对话框
- [ ] 实现格式选择
- [ ] 实现导出内容选项
- [ ] 实现导出进度显示
- [ ] 实现批量导出

**验收标准**：
- ✅ 支持所有格式导出
- ✅ 导出数据正确
- ✅ 批量导出功能正常

### 技术要点

- 工作流引擎
- 统计聚合
- 数据导出
- ECharts 图表

### 预估完成时间
- 7.5 个工作日

---

## 阶段七：热力图与高级功能

### 目标
- 实现标注密度热力图
- 实现说话人分布热力图
- 实现频谱热力图
- 实现交互式导航

### 任务清单

#### 7.1 标注密度热力图

**后端任务**：
- [ ] 实现标注密度计算 API
- [ ] 实现热力图数据生成

**前端任务**：
- [ ] 集成 ECharts 热力图
- [ ] 实现标注密度渲染
- [ ] 实现颜色图例
- [ ] 实现悬浮提示
- [ ] 实现点击跳转

**验收标准**：
- ✅ 热力图正确显示
- ✅ 颜色梯度合理
- ✅ 交互响应灵敏

#### 7.2 说话人分布热力图

**后端任务**：
- [ ] 实现说话人分布数据 API

**前端任务**：
- [ ] 实现说话人分布渲染
- [ ] 实现说话人列表显示
- [ ] 实现活跃度色块
- [ ] 实现点击跳转

**验收标准**：
- ✅ 说话人分布清晰
- ✅ 活跃度显示准确

#### 7.3 频谱热力图

**AI 服务任务**：
- [ ] 实现频谱计算服务

**后端任务**：
- [ ] 实现频谱数据 API

**前端任务**：
- [ ] 实现频谱渲染
- [ ] 实现频率轴显示
- [ ] 实现时间轴显示
- [ ] 实现能量颜色图例
- [ ] 实现缩放控制

**验收标准**：
- ✅ 频谱图正确显示
- ✅ 能量分布准确

#### 7.4 交互式导航

**前端任务**：
- [ ] 实现十字准线
- [ ] 实现悬浮信息框
- [ ] 实现点击响应动画
- [ ] 实现波形同步高亮

**验收标准**：
- ✅ 交互流畅
- ✅ 跳转准确

### 技术要点

- ECharts 热力图
- 数据聚合
- 频谱计算
- 交互事件处理

### 预估完成时间
- 5 个工作日

---

## 阶段八：长音频优化

### 目标
- 实现音频分块架构
- 实现多级波形渲染
- 实现 AI 流式推送
- 实现时间范围标注加载

### 任务清单

#### 8.1 音频分块架构

**后端任务**：
- [ ] 实现自动分段算法（静音检测）
- [ ] 实现分段合并/拆分 API
- [ ] 实现分段元数据提取

**前端任务**：
- [ ] 创建分段导航目录
- [ ] 实现分段跳转
- [ ] 实现分段书签
- [ ] 实现分段合并/拆分

**验收标准**：
- ✅ 分段逻辑合理
- ✅ 分段导航流畅

#### 8.2 多级波形渲染

**后端任务**：
- [ ] 实现多级波形生成算法
- [ ] 实现波形瓦片存储
- [ ] 实现按需加载 API

**前端任务**：
- [ ] 实现三级波形缩放
- [ ] 实现波形瓦片加载
- [ ] 实现预加载机制
- [ ] 实现性能优化（60fps）

**验收标准**：
- ✅ 波形渲染流畅
- ✅ 缩放平滑
- ✅ 加载速度快

#### 8.3 AI 流式推送

**后端任务**：
- [ ] 实现多阶段进度更新
- [ ] 实现流式结果推送
- [ ] 实现断点续传
- [ ] 实现进度存储

**前端任务**：
- [ ] 实现多阶段进度显示
- [ ] 实现结果分片接收
- [ ] 实现边处理边查看

**验收标准**：
- ✅ 进度实时更新
- ✅ 结果流式推送
- ✅ 断点恢复可靠

#### 8.4 时间范围标注加载

**后端任务**：
- [ ] 实现时间范围查询 API
- [ ] 实现游标分页

**前端任务**：
- [ ] 实现智能加载策略
- [ ] 实现预加载机制
- [ ] 实现 LRU 缓存
- [ ] 实现内存控制

**验收标准**：
- ✅ 加载速度快
- ✅ 内存占用合理

### 技术要点

- 静音检测算法
- 瓦片渲染技术
- 流式数据处理
- LRU 缓存

### 预估完成时间
- 10 个工作日

---

## 阶段九：性能优化与测试

### 目标
- 优化前端性能
- 优化后端性能
- 编写测试用例
- 修复已知问题

### 任务清单

#### 9.1 前端性能优化

**任务**：
- [ ] 实现虚拟滚动（长列表）
- [ ] 优化波形渲染性能
- [ ] 实现懒加载
- [ ] 优化打包体积
- [ ] 实现资源预加载
- [ ] 优化网络请求
- [ ] 实现错误边界

**验收标准**：
- ✅ 首屏加载 < 3 秒
- ✅ 列表渲染流畅（60fps）
- ✅ 内存占用合理

#### 9.2 后端性能优化

**任务**：
- [ ] 优化数据库查询
- [ ] 添加数据库索引
- [ ] 实现查询缓存
- [ ] 优化 WebSocket 连接
- [ ] 实现连接池
- [ ] 优化文件流传输

**验收标准**：
- ✅ API 响应时间 < 500ms
- ✅ 数据库查询优化
- ✅ WebSocket 稳定

#### 9.3 测试用例编写

**任务**：
- [ ] 编写前端单元测试
- [ ] 编写前端 E2E 测试
- [ ] 编写后端单元测试
- [ ] 编写后端集成测试
- [ ] 编写 AI 服务测试
- [ ] 实现测试覆盖率报告

**验收标准**：
- ✅ 测试覆盖率 > 80%
- ✅ 所有测试通过

#### 9.4 Bug 修复

**任务**：
- [ ] 修复已知 Bug
- [ ] 优化用户体验
- [ ] 修复性能问题

**验收标准**：
- ✅ 无严重 Bug
- ✅ 用户体验良好

### 技术要点

- 虚拟滚动
- 懒加载
- 查询优化
- 测试框架

### 预估完成时间
- 7.5 个工作日

---

## 阶段十：部署与上线

### 目标
- 配置生产环境
- 部署应用
- 监控与维护
- 文档完善

### 任务清单

#### 10.1 生产环境配置

**任务**：
- [ ] 配置生产数据库
- [ ] 配置生产 Redis
- [ ] 配置生产 MinIO
- [ ] 配置 HTTPS
- [ ] 配置负载均衡
- [ ] 配置 CDN

**验收标准**：
- ✅ 环境配置正确
- ✅ 安全配置到位

#### 10.2 应用部署

**任务**：
- [ ] 配置 CI/CD 流程
- [ ] 构建生产镜像
- [ ] 部署前端应用
- [ ] 部署后端服务
- [ ] 部署 AI 服务
- [ ] 配置自动扩容

**验收标准**：
- ✅ 部署流程顺畅
- ✅ 服务稳定运行

#### 10.3 监控与维护

**任务**：
- [ ] 配置日志收集
- [ ] 配置监控告警
- [ ] 配置性能监控
- [ ] 配置错误追踪
- [ ] 实现健康检查
- [ ] 编写运维文档

**验收标准**：
- ✅ 监控完善
- ✅ 告警及时

#### 10.4 文档完善

**任务**：
- [ ] 完善 API 文档
- [ ] 更新用户手册
- [ ] 编写部署文档
- [ ] 编写故障排查指南

**验收标准**：
- ✅ 文档完整准确

### 技术要点

- Docker 部署
- CI/CD 流程
- 监控系统
- 日志管理

### 预估完成时间
- 5 个工作日

---

## 附录

### A. 技术栈总结

| 分类 | 技术 |
|------|------|
| 前端 | Vue 3, TypeScript, Vite, Tailwind CSS, Element Plus, WaveSurfer.js, ECharts |
| 后端 | NestJS, Fastify, TypeORM, PostgreSQL, Redis, Socket.io, Bull |
| AI 服务 | FastAPI, PyTorch, Whisper, Pyannote.audio, Celery |
| 存储 | PostgreSQL, Redis, MinIO |
| 部署 | Docker, Docker Compose, Nginx |

### B. 数据库表清单

| 表名 | 说明 |
|------|------|
| users | 用户表 |
| teams | 团队表 |
| team_members | 团队成员表 |
| projects | 项目表 |
| audio_files | 音频文件表 |
| audio_folders | 音频文件夹表 |
| annotations | 标注表 |
| annotation_layers | 标注层表 |
| speakers | 说话人表 |
| tags | 标签表 |
| annotation_tags | 标注标签关联表 |
| comments | 评论表 |
| annotation_versions | 版本历史表 |
| tasks | 任务表 |
| notifications | 通知表 |
| ai_jobs | AI 处理任务表 |
| ai_job_progress | AI 任务进度表 |
| ai_result_chunks | AI 结果分片表 |
| audio_segments | 音频分段表 |
| segment_navigation | 分段导航目录表 |
| segment_bookmarks | 分段书签表 |
| waveform_cache | 波形缓存表 |
| sessions | 会话表 |

### C. API 接口清单

#### 认证模块
- POST /api/auth/register - 用户注册
- POST /api/auth/login - 用户登录
- POST /api/auth/logout - 用户登出
- POST /api/auth/refresh - 刷新令牌
- POST /api/auth/request-password-reset - 请求密码重置
- POST /api/auth/reset-password - 重置密码

#### 用户模块
- GET /api/users/profile - 获取用户信息
- PATCH /api/users/profile - 更新用户信息

#### 团队模块
- POST /api/teams - 创建团队
- GET /api/teams - 获取团队列表
- POST /api/teams/:id/invite - 邀请成员
- DELETE /api/teams/:id/members/:userId - 移除成员

#### 项目模块
- POST /api/projects - 创建项目
- GET /api/projects - 获取项目列表
- GET /api/projects/:id - 获取项目详情
- PATCH /api/projects/:id - 更新项目
- DELETE /api/projects/:id - 删除项目

#### 音频模块
- POST /api/audio/upload - 上传音频
- GET /api/audio - 获取音频列表
- GET /api/audio/:id - 获取音频详情
- DELETE /api/audio/:id - 删除音频
- GET /api/audio/:id/stream - 流式传输
- GET /api/audio/:id/waveform - 获取波形数据

#### 标注模块
- POST /api/annotations - 创建标注
- GET /api/annotations - 获取标注列表
- GET /api/annotations/:id - 获取标注详情
- PATCH /api/annotations/:id - 更新标注
- DELETE /api/annotations/:id - 删除标注

#### AI 模块
- POST /api/ai/asr - 触发 ASR
- GET /api/ai/jobs/:id - 获取任务进度
- GET /api/ai/jobs/:id/result - 获取任务结果

#### 任务模块
- POST /api/tasks - 创建任务
- GET /api/tasks - 获取任务列表
- PATCH /api/tasks/:id/assign - 分配任务

#### 导出模块
- POST /api/export - 导出数据

### D. 验收标准汇总

#### 功能验收
- [ ] 用户可以注册、登录、登出
- [ ] 用户可以创建和管理项目
- [ ] 用户可以上传和管理音频文件
- [ ] 用户可以创建和管理标注
- [ ] AI 可以自动转写音频
- [ ] AI 可以分离说话人
- [ ] 多人可以实时协作编辑
- [ ] 用户可以提交审核
- [ ] 审核员可以审核标注
- [ ] 用户可以导出数据

#### 性能验收
- [ ] 首屏加载时间 < 3 秒
- [ ] API 响应时间 < 500ms
- [ ] 波形渲染保持 60fps
- [ ] 长音频（10小时）加载时间 < 3 秒
- [ ] AI 处理进度更新延迟 < 1 秒
- [ ] 标注范围加载时间 < 500ms
- [ ] 内存占用 < 300MB

#### 兼容性验收
- [ ] 支持 Chrome 90+
- [ ] 支持 Firefox 88+
- [ ] 支持 Safari 14+
- [ ] 支持 Edge 90+

#### 安全验收
- [ ] 数据传输加密（HTTPS）
- [ ] 敏感数据加密存储
- [ ] 防止 SQL 注入
- [ ] 防止 XSS 攻击
- [ ] 访问频率限制

### E. 风险与应对

| 风险 | 影响 | 应对措施 |
|------|------|----------|
| AI 模型性能不足 | 高 | 支持多种模型选择、模型缓存、异步处理 |
| 长音频处理卡顿 | 高 | 分段处理、流式推送、按需加载 |
| 实时协作冲突 | 中 | 编辑锁定、冲突检测、自动合并 |
| 数据库性能瓶颈 | 中 | 查询优化、索引优化、缓存策略 |
| WebSocket 连接不稳定 | 中 | 自动重连、心跳检测、断线重连 |
| 浏览器兼容性问题 | 低 | 渐进增强、Polyfill、兼容性测试 |

### F. 里程碑

| 里程碑 | 时间 | 内容 |
|--------|------|------|
| M1 - MVP 完成 | 第 5 周 | 用户认证、音频管理、基础标注、AI ASR |
| M2 - 核心功能 | 第 10 周 | 多层标注、AI 辅助、实时协作 |
| M3 - 高级功能 | 第 15 周 | 质量控制、任务管理、热力图 |
| M4 - 长音频优化 | 第 25 周 | 音频分块、多级波形、流式 AI |
| M5 - 性能优化 | 第 32 周 | 性能优化、测试、Bug 修复 |
| M6 - 上线发布 | 第 35 周 | 部署上线、监控、文档完善 |

---

## 变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|----------|--------|
| v1.3.0 | 2026-02-13 | 完成步骤1-6：前端登录/注册页面、Token存储、自动登录、路由守卫、项目管理API、团队管理API；后端构建成功 | Claude |
| v1.2.0 | 2026-02-13 | 完成步骤1-5：数据库设计、TypeORM实体、数据库迁移、用户认证API、JWT服务和权限守卫；后端API测试通过 | Claude |
| v1.1.0 | 2026-02-13 | 更新阶段一进度，标记基础架构已完成，添加下一步任务 | Claude |
| v1.0.0 | 2026-02-13 | 初始版本，制定开发计划 | Claude |

---

**文档结束**