# 线上语音标注工具需求文档

## 1. 项目概述

### 1.1 项目背景
构建一个基于 Web 的语音数据标注平台，支持团队协作完成大规模语音数据的标注、审核和管理工作，为机器学习模型训练提供高质量标注数据。

### 1.2 目标用户
- 标注员：执行语音标注任务
- 审核员：审核标注质量
- 项目管理员：管理项目、分配任务、查看统计
- 系统管理员：管理用户、配置系统

---

## 2. 核心功能模块

### 2.1 音频管理模块

#### 2.1.1 音频上传

**功能描述**：支持批量上传音频文件，格式支持 MP3、WAV、FLAC、OGG、M4A。

**操作步骤**：
1. 用户点击「上传音频」按钮，打开上传对话框
2. 用户可选择以下方式上传：
   - 拖拽文件到上传区域
   - 点击「选择文件」按钮，从本地文件管理器选择
   - 点击「选择文件夹」按钮，批量上传整个文件夹
3. 系统显示上传进度条，实时显示每个文件的上传状态
4. 上传完成后，系统自动验证文件格式和完整性
5. 验证通过的文件显示在文件列表中，验证失败的显示错误提示
6. 用户可点击「查看详情」查看每个文件的上传结果

**界面元素**：
- 上传按钮（主导航栏）
- 拖拽上传区域（虚线边框）
- 文件列表（显示文件名、大小、格式、上传状态）
- 进度条（单个文件和整体进度）
- 错误提示（格式不支持、文件损坏等）

---

#### 2.1.2 音频预览

**功能描述**：上传后自动生成波形图预览，方便用户快速浏览音频内容。

**操作步骤**：
1. 用户在文件列表中点击音频文件
2. 系统自动加载音频并生成波形图
3. 波形图显示在右侧预览区域
4. 用户可点击波形图任意位置进行快速预览播放
5. 鼠标悬停在波形图上显示当前时间点

**界面元素**：
- 波形图显示区域
- 时间轴刻度
- 当前播放位置指示器
- 音频基本信息（时长、采样率、声道）

---

#### 2.1.3 文件夹管理

**功能描述**：支持创建文件夹、移动、重命名、删除等文件管理操作。

**操作步骤**：

**创建文件夹**：
1. 用户点击「新建文件夹」按钮
2. 输入文件夹名称
3. 点击「确认」创建文件夹

**移动文件/文件夹**：
1. 用户选中一个或多个文件/文件夹
2. 点击「移动」按钮或右键选择「移动到」
3. 在弹出的目录树中选择目标位置
4. 点击「确认」完成移动

**重命名**：
1. 用户右键点击文件/文件夹
2. 选择「重命名」
3. 输入新名称，按 Enter 确认

**删除**：
1. 用户选中一个或多个文件/文件夹
2. 点击「删除」按钮或右键选择「删除」
3. 系统弹出确认对话框
4. 用户点击「确认」完成删除

**界面元素**：
- 文件树形结构
- 右键上下文菜单
- 批量操作工具栏
- 确认对话框

---

#### 2.1.4 元数据管理

**功能描述**：自动提取音频时长、采样率、声道等信息，支持手动补充元数据。

**操作步骤**：
1. 用户选中音频文件
2. 系统自动提取并显示音频元数据
3. 用户点击「编辑元数据」可添加自定义字段
4. 可添加的元数据包括：来源、录制日期、说话人信息、场景描述等
5. 点击「保存」保存元数据

**界面元素**：
- 元数据面板（侧边栏）
- 自动提取信息展示区
- 自定义字段编辑区
- 保存/取消按钮

---

### 2.2 音频播放器模块

#### 2.2.1 基础控制

**功能描述**：播放、暂停、停止、上一段、下一段等基础播放控制。

**操作步骤**：
1. 用户点击音频文件进入标注界面
2. 播放器自动加载音频
3. 点击「播放」按钮或按空格键开始播放
4. 点击「暂停」按钮或按空格键暂停播放
5. 点击「停止」按钮停止播放并回到起始位置
6. 点击「上一段/下一段」按钮跳转到相邻标注段落
7. 播放进度条显示当前播放位置
8. 拖动进度条可跳转到任意位置

**界面元素**：
- 播放/暂停按钮（中央大按钮）
- 停止按钮
- 上一段/下一段按钮
- 进度条（可拖动）
- 当前时间/总时长显示
- 播放状态指示器

**快捷键**：
| 快捷键 | 功能 |
|--------|------|
| 空格 | 播放/暂停 |
| Esc | 停止 |
| 左方向键 | 后退5秒 |
| 右方向键 | 前进5秒 |
| Shift+左 | 上一段标注 |
| Shift+右 | 下一段标注 |
| Home | 跳转到开头 |
| End | 跳转到结尾 |

---

#### 2.2.2 波形显示

**功能描述**：可视化音频波形，支持缩放和平移。

**操作步骤**：
1. 音频加载后自动显示波形图
2. 用户滚动鼠标滚轮进行缩放（放大/缩小波形）
3. 按住鼠标左键拖动可平移波形视图
4. 双击波形图可重置为默认视图
5. 点击「放大/缩小」按钮可精确控制缩放比例
6. 点击「适应窗口」按钮自动调整波形大小

**界面元素**：
- 波形画布
- 缩放滑块
- 放大/缩小按钮
- 适应窗口按钮
- 时间刻度标尺
- 当前视图范围指示

**快捷键**：
| 快捷键 | 功能 |
|--------|------|
| + / = | 放大波形 |
| - | 缩小波形 |
| Ctrl+0 | 适应窗口 |
| 鼠标滚轮 | 缩放 |

---

#### 2.2.3 播放速度

**功能描述**：0.5x ~ 2x 变速播放，方便快速浏览或慢速精听。

**操作步骤**：
1. 用户点击播放速度按钮（默认显示 1.0x）
2. 从下拉菜单选择预设速度：0.5x、0.75x、1.0x、1.25x、1.5x、2.0x
3. 或拖动速度滑块精确调整（0.5x ~ 2.0x）
4. 选择后立即生效，播放速度实时调整
5. 速度设置在当前音频会话中保持

**界面元素**：
- 速度显示按钮
- 速度下拉菜单
- 速度调节滑块
- 预设速度快捷按钮

**快捷键**：
| 快捷键 | 功能 |
|--------|------|
| [ | 减速（每次-0.25） |
| ] | 加速（每次+0.25） |
| / | 重置为 1.0x |

---

#### 2.2.4 跳转控制

**功能描述**：精确跳转到指定时间点或标注位置。

**操作步骤**：

**精确时间跳转**：
1. 用户点击时间显示区域
2. 输入目标时间（格式：HH:MM:SS.mmm 或 MM:SS.mmm）
3. 按 Enter 确认，播放器跳转到指定位置

**跳转到标注**：
1. 用户点击标注列表中的某个标注项
2. 播放器自动跳转到该标注的起始位置
3. 或使用「上一标注/下一标注」按钮跳转

**快捷跳转**：
1. 按左/右方向键后退/前进 5 秒
2. 按 Shift+左/右 后退/前进 1 秒
3. 按 Ctrl+左/右 后退/前进 0.1 秒

**界面元素**：
- 可编辑时间显示
- 时间输入对话框
- 标注列表（可点击跳转）
- 快捷跳转按钮

---

#### 2.2.5 循环播放

**功能描述**：A-B 点循环播放指定片段，方便反复听取同一段落。

**操作步骤**：
1. 用户在波形上点击设置 A 点（起始点）
2. 再点击设置 B 点（结束点）
3. 系统自动进入循环播放模式
4. 播放器在 A-B 区间内循环播放
5. 用户点击「取消循环」按钮或再次点击 A/B 点退出循环模式

**替代操作方式**：
1. 用户在波形上拖拽选择一个区域
2. 右键选择「循环播放此区域」
3. 系统自动将该区域设为 A-B 循环区间

**界面元素**：
- A 点标记（绿色）
- B 点标记（红色）
- 循环区域高亮显示
- 循环状态指示器
- 取消循环按钮

**快捷键**：
| 快捷键 | 功能 |
|--------|------|
| Ctrl+A | 设置 A 点（当前位置） |
| Ctrl+B | 设置 B 点（当前位置） |
| Ctrl+L | 开启/关闭循环播放 |
| Ctrl+Shift+A | 清除 A-B 点 |

---

#### 2.2.6 音量调节

**功能描述**：音量控制、静音切换。

**操作步骤**：
1. 用户点击音量图标打开音量滑块
2. 拖动滑块调节音量（0% ~ 100%）
3. 点击音量图标可快速静音/取消静音
4. 静音状态下图标显示为静音状态

**界面元素**：
- 音量图标（显示当前状态）
- 音量滑块
- 音量百分比显示
- 静音状态图标

**快捷键**：
| 快捷键 | 功能 |
|--------|------|
| ↑ | 音量增加 10% |
| ↓ | 音量减少 10% |
| M | 静音/取消静音 |

---

### 2.3 标注功能模块

#### 2.3.1 时间区间选择

**功能描述**：在波形上拖拽选择时间区间进行标注。

**操作步骤**：
1. 用户在波形图上按住鼠标左键开始拖拽
2. 拖拽过程中显示选择区域（高亮显示）
3. 松开鼠标完成选择
4. 系统自动弹出标注编辑面板
5. 用户可在面板中输入标注内容
6. 点击「确认」保存标注，选择区域变为标注色块
7. 点击「取消」放弃标注，选择区域消失

**精确调整**：
1. 用户点击已有标注的边缘
2. 拖拽边缘可调整起止时间
3. 或在编辑面板中直接输入精确时间值

**界面元素**：
- 波形选择区域（半透明高亮）
- 起止时间显示
- 标注编辑弹窗
- 精确时间输入框

**快捷键**：
| 快捷键 | 功能 |
|--------|------|
| Ctrl+N | 新建标注（当前位置） |
| Delete | 删除选中标注 |
| Enter | 确认保存标注 |

---

#### 2.3.2 标注绑定

**功能描述**：为时间区间绑定文本内容、标签、说话人等信息。

**操作步骤**：
1. 用户选中或创建一个时间区间
2. 在标注编辑面板中进行以下操作：
   - **输入文本内容**：在文本框中输入转写文本
   - **选择说话人**：从下拉菜单选择或新建说话人
   - **添加标签**：点击标签按钮，从标签库选择或创建新标签
   - **添加备注**：在备注区域添加补充说明
3. 点击「保存」保存所有标注信息

**界面元素**：
- 标注编辑面板
- 文本输入框
- 说话人选择器
- 标签选择器
- 备注输入框
- 保存/取消按钮

---

#### 2.3.3 多层标注

**功能描述**：支持多个标注层（说话人层、情感层、事件层等），各层独立管理。

**操作步骤**：
1. 用户点击「标注层管理」按钮
2. 在层面板中查看现有标注层
3. 点击「新建层」创建新的标注层
4. 输入层名称、选择层类型、设置层颜色
5. 在层列表中点击切换当前活动层
6. 新建的标注自动归属当前活动层
7. 可通过层可见性开关控制各层显示/隐藏

**界面元素**：
- 标注层面板
- 层列表（可拖拽排序）
- 新建层按钮
- 层设置（名称、类型、颜色）
- 层可见性开关
- 层编辑/删除操作

**预设标注层**：
| 层名称 | 用途 | 默认颜色 |
|--------|------|----------|
| 转写层 | 语音转写文本 | 蓝色 |
| 说话人层 | 说话人识别 | 绿色 |
| 情感层 | 情感标注 | 橙色 |
| 事件层 | 事件标记 | 紫色 |
| 噪音层 | 噪音/静音标记 | 灰色 |

---

#### 2.3.4 文本转写编辑

**功能描述**：富文本编辑器，支持文本转写、时间戳插入、说话人标记。

**操作步骤**：

**基本转写**：
1. 用户选中一个时间区间
2. 在文本编辑区输入转写文本
3. 支持 Enter 换行
4. 支持粘贴多行文本

**插入时间戳**：
1. 用户在文本中定位光标位置
2. 点击「插入时间戳」按钮或按 Ctrl+T
3. 系统在光标位置插入当前播放时间（如 [00:15.230]）
4. 点击时间戳可跳转到对应位置

**说话人标记**：
1. 用户选中文本片段
2. 点击「标记说话人」按钮
3. 从说话人列表选择或新建说话人
4. 选中文本显示说话人颜色标识

**非语音标记**：
1. 用户点击「非语音标记」按钮
2. 选择标记类型：背景音、噪音、静音、音乐等
3. 系统在文本中插入对应标记符号

**界面元素**：
- 文本编辑器
- 工具栏（加粗、斜体、时间戳等）
- 说话人选择器
- 非语音标记菜单
- 字数统计显示

**快捷键**：
| 快捷键 | 功能 |
|--------|------|
| Ctrl+T | 插入时间戳 |
| Ctrl+Shift+S | 标记说话人 |
| Ctrl+Shift+N | 非语音标记 |

---

#### 2.3.5 标签体系

**功能描述**：预设标签库、自定义标签、多级标签树、标签颜色。

**操作步骤**：

**使用预设标签**：
1. 用户在标注编辑面板点击「添加标签」
2. 在标签选择器中浏览预设标签分类
3. 点击标签即可添加到当前标注
4. 已选标签显示在标注信息中

**创建自定义标签**：
1. 用户点击「标签管理」进入标签设置
2. 点击「新建标签」
3. 输入标签名称、描述
4. 选择标签颜色
5. 选择父级标签（创建层级结构）
6. 点击「保存」创建标签

**标签搜索**：
1. 用户在标签选择器中输入搜索关键词
2. 系统实时过滤匹配的标签
3. 点击搜索结果可直接使用

**界面元素**：
- 标签选择器弹窗
- 标签分类导航
- 标签搜索框
- 标签颜色选择器
- 标签层级树
- 已选标签列表

**预设标签分类**：

**情感标签**：
| 标签 | 描述 | 颜色 |
|------|------|------|
| 高兴 | 正面积极情绪 | #4CAF50 |
| 悲伤 | 负面消极情绪 | #2196F3 |
| 愤怒 | 激烈负面情绪 | #F44336 |
| 恐惧 | 害怕、担心情绪 | #9C27B0 |
| 惊讶 | 意外、震惊情绪 | #FF9800 |
| 中性 | 平静无情绪 | #9E9E9E |

**场景标签**：
| 标签 | 描述 |
|------|------|
| 室内 | 室内环境 |
| 室外 | 室外环境 |
| 安静 | 低噪声环境 |
| 嘈杂 | 高噪声环境 |
| 会议 | 会议场景 |
| 电话 | 电话通话 |

---

### 2.4 AI辅助模块 ⭐（必须）

#### 2.4.1 自动语音识别（ASR）

**功能描述**：上传音频后自动生成初始转写文本，显示置信度。

**操作步骤**：

**触发ASR处理**：
1. 用户上传音频文件后，系统自动检测是否启用 ASR
2. 若已启用，音频自动加入处理队列
3. 用户也可手动点击「AI转写」按钮触发处理
4. 在「AI处理状态」面板查看处理进度

**查看ASR结果**：
1. 处理完成后，系统在标注区显示转写结果
2. 每个词/字下方显示置信度指示条
3. 低置信度（<70%）词/字以黄色高亮显示
4. 用户可点击词/字查看详细置信度数值

**编辑ASR结果**：
1. 用户点击转写文本中的词/字
2. 修改为正确内容
3. 修改后的内容去除置信度标记
4. 系统记录人工修正用于模型优化

**界面元素**：
- AI转写按钮
- 处理进度条
- 处理状态面板
- 置信度指示条
- 低置信度高亮显示
- 详细置信度悬浮提示

---

#### 2.4.2 说话人分离

**功能描述**：自动识别和区分不同说话人。

**操作步骤**：
1. ASR 处理时自动执行说话人分离
2. 处理完成后，不同说话人的语音显示不同颜色
3. 标注面板自动创建说话人标签（说话人1、说话人2...）
4. 用户可重命名说话人标签
5. 用户可手动合并或拆分说话人段落
6. 可在说话人管理面板查看说话人统计信息

**界面元素**：
- 说话人颜色标识
- 说话人管理面板
- 说话人重命名对话框
- 说话人合并/拆分工具

---

#### 2.4.3 自动分段

**功能描述**：基于静音检测自动切分音频段落。

**操作步骤**：
1. 用户点击「自动分段」按钮
2. 在设置面板中配置参数：
   - 最小静音时长（默认 0.5 秒）
   - 最小段落时长（默认 1 秒）
   - 最大段落时长（默认 30 秒）
3. 点击「应用」执行自动分段
4. 系统在波形上显示分段标记
5. 用户可手动调整或删除分段

**界面元素**：
- 自动分段按钮
- 分段参数设置面板
- 分段预览显示
- 应用/取消按钮

---

#### 2.4.4 智能标签推荐

**功能描述**：基于音频内容自动推荐标签。

**操作步骤**：
1. 用户选中一个标注段落
2. 点击「智能推荐」按钮
3. 系统分析音频内容和转写文本
4. 在推荐面板显示建议标签（按置信度排序）
5. 用户点击推荐标签即可添加
6. 也可忽略推荐手动选择标签

**界面元素**：
- 智能推荐按钮
- 推荐标签面板
- 置信度显示
- 一键添加按钮

---

#### 2.4.5 噪音检测

**功能描述**：自动检测并标记噪音片段。

**操作步骤**：
1. 用户点击「噪音检测」按钮
2. 系统分析音频，识别噪音片段
3. 在波形上以灰色标记噪音区域
4. 在标注列表中自动添加噪音标注
5. 用户可手动调整或删除噪音标记

**界面元素**：
- 噪音检测按钮
- 噪音区域标记
- 噪音类型识别（背景噪音、突然噪音等）

---

#### 2.4.6 AI模型管理

**功能描述**：支持选择不同的 ASR 模型，查看处理进度，模型版本管理。

**操作步骤**：

**选择模型**：
1. 用户进入「AI设置」面板
2. 在模型列表中选择要使用的模型
3. 查看模型说明（支持语言、准确率、速度、模型大小等）
4. 选择后设为默认模型

**模型类型**：
| 模型 | 大小 | 准确率 | 速度 | 推荐场景 |
|------|------|--------|------|----------|
| Whisper Tiny | 39MB | 中 | 极快 | 快速预览 |
| Whisper Base | 74MB | 中高 | 快 | 一般场景 |
| Whisper Small | 244MB | 高 | 中 | 标准场景 |
| Whisper Medium | 769MB | 很高 | 慢 | 高质量场景 |
| Whisper Large-v3 | 1550MB | 最高 | 很慢 | 精确场景 |

**批量处理**：
1. 用户在文件列表中选择多个音频
2. 点击「批量AI处理」
3. 选择处理类型（转写、说话人分离、噪音检测等）
4. 选择使用的模型
5. 点击「开始处理」
6. 在处理队列面板查看进度

**模型更新策略**：
1. 系统管理员可上传新版本模型
2. 模型上传后自动进行性能评估
3. 新模型默认标记为"测试"状态
4. 可选择将新模型设为默认或保留旧模型
5. 已使用旧模型的标注不受影响

**模型性能评估**：
- 自动评估指标：准确率、处理速度、资源占用
- 可选择评估样本进行人工评估
- 评估结果记录到模型历史

**界面元素**：
- AI设置面板
- 模型选择列表
- 模型说明卡片
- 模型历史记录
- 批量处理对话框
- 处理队列面板
- 进度条
- 模型上传功能（管理员）

---

### 2.5 热力图模块 ⭐（必须）

#### 2.5.1 标注密度热力图

**功能描述**：显示音频不同时间段的标注密集程度。

**操作步骤**：
1. 用户进入音频标注界面
2. 在波形图下方显示标注密度热力图
3. 热力图颜色从蓝到红表示密度从低到高
4. 鼠标悬停显示该时间段的标注数量
5. 点击热力图某区域，播放器跳转到对应时间点
6. 可在设置中切换热力图类型

**界面元素**：
- 热力图条（波形下方）
- 颜色图例（密度对应颜色）
- 悬浮提示信息
- 热力图类型切换按钮

---

#### 2.5.2 说话人分布热力图

**功能描述**：可视化不同说话人的时间分布。

**操作步骤**：
1. 用户点击热力图类型选择器
2. 选择「说话人分布」视图
3. 热力图按说话人分列显示
4. 每行代表一个说话人
5. 颜色深度表示该说话人在该时间段的活跃程度
6. 点击某个说话人的时间块，播放器跳转并高亮该段落

**界面元素**：
- 说话人列表（行标题）
- 时间轴（列）
- 活跃度色块
- 点击交互

---

#### 2.5.3 频谱热力图

**功能描述**：时频谱热力图显示音频频率分布。

**操作步骤**：
1. 用户点击「频谱视图」按钮
2. 系统生成音频的时频谱图
3. X轴表示时间，Y轴表示频率
4. 颜色表示该时间频率点的能量强度
5. 用户可缩放查看特定频率范围
6. 鼠标悬停显示精确频率和时间值

**界面元素**：
- 频谱热力图画布
- 频率轴（Y轴）
- 时间轴（X轴）
- 能量颜色图例
- 缩放控制

---

#### 2.5.4 交互查看

**功能描述**：点击热力图跳转到对应时间点，实现快速导航。

**操作步骤**：
1. 用户在任意热力图上移动鼠标
2. 显示十字准线指示当前位置
3. 显示悬浮信息框（时间、数值等）
4. 单击鼠标左键
5. 播放器跳转到对应时间点
6. 波形图同步显示该位置

**界面元素**：
- 十字准线
- 悬浮信息框
- 点击响应动画
- 波形同步高亮

---

### 2.6 实时协作模块 ⭐（必须）

#### 2.6.1 多人协作编辑

**功能描述**：多人同时编辑同一音频，实时看到彼此修改。

**操作步骤**：
1. 多个用户打开同一个音频文件
2. 系统自动建立 WebSocket 连接
3. 系统自动加入音频协作房间（命名规则：`audio:{audioId}`）
4. 如果用户同时处理多个 AI 任务，会同时加入任务房间（命名规则：`ai-job:{jobId}`）
5. 用户可同时加入多个房间，接收对应房间的实时消息
6. 右侧面板显示在线协作者列表
7. 每个协作者有唯一颜色标识
8. 协作者的编辑操作实时同步到所有客户端
9. 其他协作者的选区和光标以对应颜色显示
10. 协作者的播放位置显示在各自波形上

**房间管理机制**：
- 音频协作房间：用于同步编辑操作、光标位置、播放状态
- AI 任务房间：用于推送 AI 处理进度、结果分片
- 项目通知房间：用于推送项目级别的消息
- 房间自动创建，无需手动配置
- 用户离开页面时自动退出所有房间
- 网络断开时自动重连并重新加入房间

**界面元素**：
- 在线协作者列表（头像+名字）
- 协作者颜色标识
- 协作者光标显示
- 协作者选区高亮
- 连接状态指示器
- 房间连接状态显示

---

#### 2.6.2 编辑锁定

**功能描述**：编辑某一片段时自动锁定，防止冲突。

**操作步骤**：
1. 用户开始编辑某个标注段落
2. 系统自动锁定该段落
3. 其他用户看到该段落显示为「正在编辑」状态
4. 显示编辑者的名字和头像
5. 其他用户无法修改被锁定的段落
6. 用户完成编辑或离开页面，锁定自动释放

**界面元素**：
- 锁定状态指示（锁图标）
- 编辑者信息显示
- 锁定段落高亮边框
- 锁定提示信息

---

#### 2.6.3 协作者光标

**功能描述**：显示其他协作者的编辑位置光标。

**操作步骤**：
1. 协作者在波形或文本区域点击/选中内容
2. 系统实时广播位置信息
3. 其他用户看到对应颜色的光标和选区
4. 光标旁边显示协作者名字
5. 选区以协作者颜色高亮显示

**界面元素**：
- 协作者光标（竖线+名字标签）
- 协作者选区（半透明色块）
- 光标动画效果

---

#### 2.6.4 评论系统

**功能描述**：对特定时间点或区域添加评论。

**操作步骤**：

**添加评论**：
1. 用户在波形上选择时间点或区域
2. 点击「添加评论」按钮或右键选择「评论」
3. 在评论输入框输入内容
4. 可 @ 其他协作者进行提醒
5. 点击「发送」提交评论
6. 评论以标记形式显示在波形上

**查看评论**：
1. 评论以小图标显示在对应时间位置
2. 点击图标展开评论内容
3. 评论面板显示所有评论列表
4. 点击列表项跳转到对应时间点

**回复评论**：
1. 用户点击评论展开详情
2. 在回复框输入内容
3. 点击「回复」发送回复
4. 回复显示在评论线程中

**界面元素**：
- 评论标记图标
- 评论气泡
- 评论面板
- 评论输入框
- @提及选择器
- 回复线程

---

#### 2.6.5 消息通知

**功能描述**：实时推送评论、修改通知。

**操作步骤**：
1. 当有人 @ 当前用户时，系统弹出通知
2. 当有人修改了当前查看的音频时，弹出修改通知
3. 当任务状态变化时，推送任务通知
4. 点击通知可跳转到相关位置
5. 在通知中心查看所有历史通知
6. 可设置通知偏好（开启/关闭某些类型通知）

**界面元素**：
- 桌面通知弹窗
- 通知铃铛图标（显示未读数）
- 通知中心面板
- 通知列表
- 通知设置

---

#### 2.6.6 版本控制

**功能描述**：自动保存、版本历史、版本对比、版本回滚。

**操作步骤**：

**自动保存**：
1. 系统仅在以下情况触发自动保存：
   - 每次重大操作（创建标注、删除标注、批量修改）后立即保存
   - 用户手动点击「保存」按钮时保存
   - 用户离开页面或关闭浏览器前保存（防丢失）
2. 自动保存策略说明：
   - 不采用定时自动保存（避免版本数量爆炸）
   - 每个标注最多保留最近 10 个版本
   - 超过保留限制的旧版本自动清理
   - 用户可在设置中调整版本保留数量（5-20个）
3. 保存状态显示在工具栏（已保存/未保存）

**查看版本历史**：
1. 用户点击「版本历史」按钮
2. 版本列表显示所有历史版本
3. 每个版本显示：时间、操作者、修改描述
4. 点击版本可预览该版本的标注状态

**版本对比**：
1. 用户选择两个版本
2. 点击「对比」按钮
3. 系统高亮显示两个版本的差异
4. 删除的内容以红色显示
5. 新增的内容以绿色显示

**版本回滚**：
1. 用户选择要回滚的版本
2. 点击「恢复到此版本」
3. 系统弹出确认对话框
4. 确认后，标注恢复到选定版本状态

**界面元素**：
- 保存状态指示器
- 版本历史按钮
- 版本列表
- 版本对比视图
- 差异高亮显示
- 恢复确认对话框

---

### 2.7 质量控制模块

#### 2.7.1 审核流程

**功能描述**：提交审核 → 审核通过/驳回 → 返工/完成的完整流程。

**操作步骤**：

**标注员提交审核**：
1. 标注员完成音频标注
2. 点击「提交审核」按钮
3. 系统弹出提交确认框，显示标注统计
4. 确认提交，状态变为「待审核」

**审核员审核**：
1. 审核员在任务列表看到「待审核」任务
2. 点击进入审核界面
3. 查看标注内容，播放音频验证
4. 可在问题位置添加评论说明问题
5. 选择「通过」或「驳回」

**审核通过**：
1. 审核员点击「通过」按钮
2. 可选填写审核备注
3. 任务状态变为「已完成」
4. 标注员收到通过通知

**审核驳回**：
1. 审核员点击「驳回」按钮
2. 必须填写驳回原因
3. 可标注具体问题位置
4. 任务状态变为「返工」
5. 标注员收到驳回通知和原因

**界面元素**：
- 提交审核按钮
- 提交确认对话框
- 审核界面（对比原始音频和标注）
- 通过/驳回按钮
- 驳回原因输入框
- 状态标签（待审核/已完成/返工）

---

#### 2.7.2 问题标记

**功能描述**：标记有问题的标注供复核。

**操作步骤**：
1. 标注员或审核员在标注上右键
2. 选择「标记问题」
3. 选择问题类型：内容错误、时间不准、标签错误、其他
4. 输入问题描述
5. 点击「确认」添加问题标记
6. 问题标记显示在标注列表中
7. 负责人可在问题列表中统一处理

**界面元素**：
- 右键菜单「标记问题」
- 问题类型选择器
- 问题描述输入框
- 问题标记图标
- 问题列表面板

---

#### 2.7.3 质量评分

**功能描述**：自动计算标注质量分数。

**操作步骤**：
1. 系统根据以下维度自动计算质量分数：
   - 文本完整性（是否有未转写段落）
   - 时间精度（时间戳是否对齐）
   - 标签覆盖率（是否有缺失标签）
   - 一致性（与审核结果的匹配度）
2. 质量分数显示在标注概览中
3. 低分标注自动标记供复核
4. 可设置质量阈值，低于阈值自动驳回

**界面元素**：
- 质量分数显示（百分比+图标）
- 各维度得分详情
- 低分警告提示
- 质量阈值设置

---

### 2.8 任务管理模块

#### 2.8.1 任务创建

**功能描述**：创建标注任务，设置截止日期、优先级。

**操作步骤**：
1. 项目管理员进入「任务管理」
2. 点击「新建任务」按钮
3. 填写任务信息：
   - 任务名称
   - 任务描述
   - 选择音频文件（可多选）
   - 设置截止日期
   - 设置优先级（高/中/低）
   - 设置预估工时
4. 点击「创建」完成任务创建

**界面元素**：
- 新建任务按钮
- 任务信息表单
- 音频文件选择器
- 日期选择器
- 优先级选择器

---

#### 2.8.2 任务分配

**功能描述**：将音频分配给指定标注员。

**操作步骤**：
1. 项目管理员在任务列表选择任务
2. 点击「分配」按钮
3. 在成员列表中选择标注员
4. 可选择分配方式：
   - 指定分配：手动选择具体人员
   - 自动分配：系统根据工作量和能力自动分配
   - 平均分配：将文件平均分配给选定人员
5. 点击「确认」完成分配
6. 被分配人员收到任务通知

**界面元素**：
- 分配按钮
- 成员选择列表
- 分配方式选项
- 确认对话框

---

#### 2.8.3 进度跟踪

**功能描述**：实时查看任务完成进度。

**操作步骤**：
1. 项目管理员进入任务详情
2. 查看任务进度面板：
   - 总体完成百分比
   - 各标注员的完成情况
   - 各状态的数量（待处理/进行中/待审核/已完成/返工）
3. 点击具体数字可查看详细列表
4. 可设置进度里程碑提醒

**界面元素**：
- 进度条
- 完成百分比
- 状态分布饼图
- 成员进度列表
- 里程碑标记

---

#### 2.8.4 统计报表

**功能描述**：个人/团队工作量统计。

**操作步骤**：
1. 项目管理员进入「统计报表」
2. 选择报表类型：
   - 个人工作量报表
   - 团队工作量报表
   - 项目进度报表
   - 质量分析报表
3. 选择时间范围
4. 系统生成报表，支持图表展示
5. 可导出报表为 Excel 或 PDF

**界面元素**：
- 报表类型选择
- 时间范围选择器
- 图表展示（柱状图、饼图、折线图）
- 数据表格
- 导出按钮

---

### 2.9 数据导出模块

#### 2.9.1 格式支持

**功能描述**：支持 JSON、CSV、TXT、SRT、VTT、XML 多种格式导出。

**操作步骤**：
1. 用户选择要导出的音频或项目
2. 点击「导出」按钮
3. 在导出对话框中选择格式：
   - **JSON**：结构化数据，适合程序处理
   - **CSV**：表格格式，适合数据分析
   - **TXT**：纯文本格式
   - **SRT**：字幕格式，时间戳+文本
   - **VTT**：WebVTT 字幕格式
   - **XML**：可扩展标记语言格式
4. 可选择导出内容（转写、标签、说话人等）
5. 点击「导出」下载文件

**界面元素**：
- 导出按钮
- 格式选择列表
- 内容选项复选框
- 导出预览
- 下载按钮

---

#### 2.9.2 批量导出

**功能描述**：导出整个项目或选定音频的标注。

**操作步骤**：
1. 用户在文件列表选择多个音频
2. 或在项目设置中选择「导出整个项目」
3. 选择导出格式和内容选项
4. 系统生成压缩包（ZIP）
5. 每个音频的标注作为独立文件
6. 包含一个汇总文件（manifest.json）

**界面元素**：
- 批量选择控件
- 项目导出选项
- 压缩包下载

---

### 2.10 用户与权限模块

#### 2.10.1 用户注册/登录

**功能描述**：支持邮箱注册登录。

**操作步骤**：

**注册**：
1. 用户点击「注册」
2. 输入邮箱地址
3. 设置密码（要求：8位以上，包含字母和数字）
4. 点击「发送验证码」
5. 输入邮箱收到的验证码
6. 填写用户名
7. 点击「完成注册」

**登录**：
1. 用户输入邮箱/用户名
2. 输入密码
3. 点击「登录」
4. 可选择「记住我」保持登录状态

**界面元素**：
- 注册表单
- 登录表单
- 验证码输入框
- 密码显示/隐藏切换
- 忘记密码链接

---

#### 2.10.2 角色管理

**功能描述**：标注员、审核员、项目管理员、系统管理员四种角色。

**角色权限对照表**：

| 功能 | 标注员 | 审核员 | 项目管理员 | 系统管理员 |
|------|--------|--------|------------|------------|
| 标注音频 | ✅ | ✅ | ✅ | ✅ |
| 查看任务 | 仅自己的 | 全部 | 全部 | 全部 |
| 提交审核 | ✅ | ✅ | ✅ | ✅ |
| 审核通过/驳回 | ❌ | ✅ | ✅ | ✅ |
| 创建任务 | ❌ | ❌ | ✅ | ✅ |
| 分配任务 | ❌ | ❌ | ✅ | ✅ |
| 查看统计 | 仅自己 | 全部 | 全部 | 全部 |
| 管理成员 | ❌ | ❌ | 项目内 | 全部 |
| 管理项目 | ❌ | ❌ | ✅ | ✅ |
| 系统设置 | ❌ | ❌ | ❌ | ✅ |
| 管理用户 | ❌ | ❌ | ❌ | ✅ |

---

#### 2.10.3 团队管理

**功能描述**：创建团队、邀请成员。

**操作步骤**：

**创建团队**：
1. 用户点击「创建团队」
2. 输入团队名称和描述
3. 点击「创建」
4. 自动成为团队管理员

**邀请成员**：
1. 团队管理员点击「邀请成员」
2. 输入成员邮箱（可多个）
3. 选择成员角色
4. 点击「发送邀请」
5. 被邀请人收到邮件，点击链接加入

**界面元素**：
- 创建团队表单
- 邀请成员对话框
- 成员列表
- 角色分配

---

## 3. 长音频场景需求 ⭐（必须）

### 3.1 场景定义

**适用范围**：1小时以上的音频文件，如会议录音、广播节目、讲座记录等。

**核心挑战**：
- 大文件加载时间过长
- 波形渲染性能瓶颈
- 标注数据量过大导致前端卡顿
- AI 处理时间过长，用户无法及时看到结果

### 3.2 音频分块架构

**功能描述**：将长音频自动分段，支持分段加载和导航。

**自动分段策略**：
- 基于静音检测自动切分（静音时长 > 0.5秒）
- 结合说话人切换点进行分段
- 最小段落时长：5秒
- 最大段落时长：5分钟

**分段导航**：
- 生成分段目录，支持快速跳转
- 显示分段元数据（静音评分、说话人切换、音乐片段等）
- 支持手动合并、拆分分段

**分段书签**：
- 用户可在关键时间点添加书签
- 书签支持颜色标记和备注
- 支持跳转到书签位置

### 3.3 多级波形渲染

**功能描述**：支持三级缩放级别的波形渲染，按需加载。

**缩放级别**：
- Overview（概览级）：每像素 1000 采样点，用于全局查看
- Detail（详细级）：每像素 100 采样点，用于标准编辑
- Zoom（缩放级）：每像素 10 采样点，用于精确编辑

**瓦片加载**：
- 只渲染可见区域的波形瓦片
- 支持预加载前后各 2 个瓦片
- 滚动时动态加载新瓦片，释放旧瓦片

**性能指标**：
- 10小时音频 Overview 级别加载 < 2秒
- Detail 级别切换响应 < 500ms
- 保持 60fps 流畅渲染

### 3.4 AI 流式推送

**功能描述**：AI 处理过程中实时推送进度和结果。

**多阶段进度显示**：
- 下载阶段：显示下载进度
- 分段阶段：显示检测到的分段数量
- 转写阶段：显示当前处理的分段进度
- 后处理阶段：显示说话人分离、标签推荐进度

**流式结果推送**：
- 每完成一个分段立即推送结果
- 用户可边等待边查看已完成的分段
- 支持点击跳转到已完成的分段

**断点续传**：
- 处理失败可从断点恢复
- 记录处理进度到数据库
- 重试时跳过已完成的分段

### 3.5 时间范围标注加载

**功能描述**：只加载当前可视时间范围内的标注。

**智能加载策略**：
- 初始加载当前播放位置前后各 2 分钟的标注
- 播放位置移动超过 1 分钟时重新加载
- 使用游标分页，避免深分页性能问题

**预加载机制**：
- 自动预加载前后各 2 分钟的标注数据
- 使用 LRU 缓存限制内存占用（最多缓存 500 条标注）
- 缓存过期时间 10 分钟

### 3.6 性能指标（长音频场景）

| 指标 | 要求 |
|------|------|
| 10小时音频初始加载 | < 3秒 |
| 波形渲染 | 流畅 60fps |
| AI 处理进度更新延迟 | < 1秒 |
| 标注范围加载 | < 500ms |
| 内存占用 | < 300MB |
| 并发协作用户 | 单音频支持 20+ 用户 |

---

## 4. 非功能性需求

### 4.1 性能要求
| 指标 | 要求 |
|------|------|
| 音频加载 | 10MB以内音频加载时间 < 3秒 |
| 波形渲染 | 波形渲染时间 < 2秒 |
| 实时同步延迟 | < 500ms |
| 并发用户 | 单项目支持 50+ 并发协作 |
| 存储容量 | 支持TB级音频存储 |
| 长音频支持 | 支持 10+ 小时音频流畅标注 |

### 4.2 兼容性要求
| 类型 | 要求 |
|------|------|
| 浏览器 | Chrome 90+、Firefox 88+、Safari 14+、Edge 90+ |
| 音频格式 | MP3、WAV、FLAC、OGG、M4A、WebM |

### 4.3 安全要求
- 数据传输加密（HTTPS）
- 敏感数据存储加密
- 防止SQL注入、XSS攻击
- 定期数据备份
- 访问频率限制

### 4.4 缓存策略

**前端缓存**：
- 标注数据：LRU 缓存，最多 500 条，TTL 10分钟
- 波形瓦片：按需加载，自动清理不可见瓦片
- 分段数据：Map 缓存，预加载前后各 2 个分段

**后端缓存**：
- 用户信息：Redis，TTL 1小时
- 音频元数据：Redis，TTL 30分钟
- 波形数据：Redis + waveform_cache 表，TTL 1小时
- AI 进度：Redis，实时更新

**缓存失效策略**：
- 数据更新：立即失效相关缓存
- 定时过期：TTL 自动失效
- 内存压力：LRU 淘汰
- 用户操作：手动刷新时失效

### 4.5 数据生命周期管理

**数据保留期限**：

| 数据类型 | 保留期限 | 清理频率 |
|---------|---------|---------|
| 会话数据（sessions） | 30天 | 每天凌晨2点 |
| 通知数据（notifications） | 90天 | 每周日凌晨3点 |
| AI 结果分片（ai_result_chunks） | 30天 | 每天凌晨1点 |
| AI 任务进度（ai_job_progress） | 7天 | 每天凌晨1点 |
| 版本历史（annotation_versions） | 90天 | 每周日凌晨4点 |
| 评论数据（comments） | 永久 | 不清理 |

**自动清理机制**：
- 系统定期扫描过期数据
- 清理任务记录到日志
- 支持手动触发清理
- 清理前生成数据快照（可选）

**数据归档策略**：
- 90天以上的标注数据可归档
- 归档数据迁移到冷存储
- 归档数据只读，不可编辑
- 支持从归档恢复

---

## 5. 技术架构建议

```
┌─────────────────────────────────────────────────────────┐
│                      前端 (Web)                          │
│         Vue 3 + WaveSurfer.js + Socket.io Client       │
└─────────────────────────────────────────────────────────┘
                            │
                            ▼ HTTPS/WSS
┌─────────────────────────────────────────────────────────┐
│                    负载均衡层 (Nginx)                     │
│                  SSL 终止、静态资源、反向代理             │
└─────────────────────────────────────────────────────────┘
                            │
        ┌───────────────────┼───────────────────┐
        ▼                   ▼                   ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│   后端服务     │   │   AI 服务      │   │  WebSocket    │
│ NestJS+Fastify│   │ Python+FastAPI│   │  Socket.io    │
│  (多实例)     │   │  (多实例)     │   │  Redis Adapter │
└───────────────┘   └───────────────┘   └───────────────┘
        │                   │                   │
        └───────────────────┼───────────────────┘
                            ▼
        ┌───────────────────┼───────────────────┐
        ▼                   ▼                   ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│  PostgreSQL   │   │    Redis      │   │  MinIO / S3   │
│   业务数据     │   │  缓存/队列     │   │   音频存储    │
└───────────────┘   └───────────────┘   └───────────────┘
```

**技术栈说明：**
- **前端**：Vue 3 + TypeScript + Vite + WaveSurfer.js + Socket.io Client
- **后端**：NestJS + Fastify + TypeORM + Socket.io + Bull
- **AI服务**：Python + FastAPI + PyTorch + Whisper + Celery
- **数据库**：PostgreSQL（主数据）+ Redis（缓存/队列）
- **存储**：MinIO（S3兼容对象存储）

**API 版本策略：**
- `/api/v1`：基础功能（用户认证、项目管理、音频上传、基础标注、AI 处理）
- `/api/v2`：长音频优化（音频分块、多级波形、流式 AI 推送、时间范围标注加载）
- 短音频（< 30分钟）使用 v1 API，长音频（≥ 30分钟）使用 v2 API

---

## 6. 开发优先级

### 第一阶段（MVP）
- 音频上传与播放器
- 基础时间戳标注
- AI自动转写（ASR）
- 标注热力图
- 实时协作基础功能
- 用户登录与权限

### 第二阶段
- 高级标注功能（多层标注、自定义标签）
- AI智能标签推荐
- 热力图高级功能
- 评论与通知系统
- 任务管理

### 第三阶段
- 长音频场景优化（音频分块、多级波形、流式AI、时间范围加载）
- 质量控制系统
- 高级统计分析
- API接口
- 性能优化

---

## 7. 验收标准

### 基础功能验收
- [ ] 用户能上传音频并看到波形
- [ ] 用户能创建、编辑、删除时间戳标注
- [ ] AI能自动转写音频并显示置信度
- [ ] 热力图能正确显示标注密度分布
- [ ] 多人能同时编辑并实时同步
- [ ] 支持导出JSON、CSV、SRT格式
- [ ] 响应时间符合性能要求

### 长音频场景验收
- [ ] 10小时音频初始加载时间 < 3秒
- [ ] 波形渲染保持 60fps 流畅度
- [ ] AI 处理进度实时更新（延迟 < 1秒）
- [ ] 标注范围加载时间 < 500ms
- [ ] 内存占用 < 300MB
- [ ] 支持 20+ 用户同时协作编辑长音频
- [ ] 分段导航功能正常工作
- [ ] 多级波形缩放平滑无卡顿